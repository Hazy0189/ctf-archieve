#!/usr/bin/env python3
from requests import get
from re import search

validip = lambda s: search(r'(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)', s)

ip = '10.0.14.20'
address = f'http://{ip}:1337/'
flag = flag2 = 'FLAG: ETSCTF_'

r = get(address, allow_redirects=False)
while 'Location' in r.headers:
    print(r.headers['Location'])
    protocol, host, port, path = search(r'^(https?:\/\/)([^:]+):([^\/]+)\/?(.*)$', r.headers['Location']).groups()
        
    if validip(host):
        address = r.headers['Location']
    else:
        flag += host
        flag2 += path
        address = f'{protocol}{ip}:{port}/{path}'
    headers = {'Host': f'{host}:{port}'}
    r = get(address, headers=headers, allow_redirects=False)
    
print(r.text, flag, flag2, get(address[:-6], headers=headers).text, sep='\n')
