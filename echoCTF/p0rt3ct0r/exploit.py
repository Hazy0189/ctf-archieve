#!/usr/bin/env python3
from requests import get
from re import search

def validip(s):
    ipregex = r'(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)'
    if search(ipregex, s):
        return True
    else:
        return False

address = 'http://10.0.14.18:1337/'
ip = '10.0.14.18'
flag = 'ETSCTF_'

r = get(address, allow_redirects=False)
while 'Location' in r.headers:
    print(r.headers['Location'])
    redirect = search(r'^(https?:\/\/)([^:]+):([^\/]+)\/?(.*)$', r.headers['Location'])
    protocol, host, port, path = redirect.groups()
        
    if validip(host):
        address = r.headers['Location']
    else:
        flag += host
        address = f'{protocol}{ip}:{port}/{path}'
    headers = {'Host': f'{host}:{port}'}
    r = get(address, headers=headers, allow_redirects=False)
    
print(r.text)
print(f'FLAG: {flag}')
