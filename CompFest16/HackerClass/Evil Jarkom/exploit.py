from scapy.all import *

# Function to check if the Evil Bit is set
def is_evil_bit_set(packet):
    if IP in packet:
        return packet[IP].flags == 0x04  # The Evil Bit is the 3rd bit in the flags field
    return False

# Function to extract the last byte of the payload
def extract_last_byte(packet):
    if Raw in packet:
        payload = packet[Raw].load
        if payload:
            return payload[-2:]  # Last byte of the payload
    return None

# Load the pcap file
packets = rdpcap('traffic.pcapng')

# Loop through packets and extract the last byte if the Evil Bit is set
for packet in packets:
    if is_evil_bit_set(packet):
        last_byte = extract_last_byte(packet)
        if last_byte is not None:
            print(f"{last_byte.decode()}", end="")  # Print the last byte in hex format
