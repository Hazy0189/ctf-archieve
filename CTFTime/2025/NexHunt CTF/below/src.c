/* This file was generated by the Hex-Rays decompiler version 9.2.0.250908.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 chall_release(); // weak
__int64 __fastcall chall_write(__int64 a1, __int64 a2, __int64 a3);
__int64 __fastcall chall_read(__int64 a1, __int64 a2, __int64 a3);
__int64 chall_open(); // weak
__int64 init_module(); // weak
__int64 cleanup_module(); // weak
// __int64 __fastcall misc_deregister(_QWORD); weak
// __int64 __fastcall copy_from_user(_QWORD, _QWORD, _QWORD); weak
// __int64 __fastcall kfree(_QWORD); weak
// __int64 __fastcall printk(_QWORD, _QWORD); weak
// __int64 __fastcall misc_register(_QWORD); weak
// __int64 __fastcall copy_to_user(_QWORD, _QWORD, _QWORD); weak
// __int64 __fastcall kmalloc_trace(_QWORD, _QWORD, _QWORD); weak

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_1EB; // weak
_UNKNOWN unk_208; // weak
_UNKNOWN unk_217; // weak
_UNKNOWN unk_22E; // weak
_UNKNOWN unk_247; // weak
_UNKNOWN unk_25E; // weak
_UNKNOWN unk_272; // weak
_UNKNOWN unk_27E; // weak
_UNKNOWN unk_298; // weak
_UNKNOWN unk_2B8; // weak
_UNKNOWN unk_2E0; // weak
_UNKNOWN chall_misc; // weak
__int64 g_buf; // weak
// extern _QWORD kmalloc_caches[6]; weak


//----- (0000000000000000) ----------------------------------------------------
__int64 chall_release()
{
  printk(&unk_208, "pwnme");
  return 0;
}
// 0: using guessed type __int64 chall_release();
// 8A0: using guessed type __int64 __fastcall printk(_QWORD, _QWORD);

//----- (0000000000000020) ----------------------------------------------------
__int64 __fastcall chall_write(__int64 a1, __int64 a2, __int64 a3)
{
  printk(&unk_2B8, "pwnme");
  printk(&unk_217, "pwnme");
  if ( !copy_from_user(g_buf, a2, a3) )
    return a3;
  printk(&unk_22E, a2);
  return -22;
}
// 880: using guessed type __int64 g_buf;
// 890: using guessed type __int64 __fastcall copy_from_user(_QWORD, _QWORD, _QWORD);
// 8A0: using guessed type __int64 __fastcall printk(_QWORD, _QWORD);

//----- (0000000000000090) ----------------------------------------------------
__int64 __fastcall chall_read(__int64 a1, __int64 a2, __int64 a3)
{
  __int64 v5; // rsi

  printk(&unk_2E0, "pwnme");
  v5 = g_buf;
  if ( !copy_to_user(a2, g_buf, a3) )
    return a3;
  printk(&unk_247, v5);
  return -22;
}
// 880: using guessed type __int64 g_buf;
// 8A0: using guessed type __int64 __fastcall printk(_QWORD, _QWORD);
// 8B0: using guessed type __int64 __fastcall copy_to_user(_QWORD, _QWORD, _QWORD);

//----- (00000000000000F0) ----------------------------------------------------
__int64 chall_open()
{
  printk(&unk_272, "pwnme");
  g_buf = kmalloc_trace(kmalloc_caches[5], 4197568, 32);
  if ( g_buf )
    return 0;
  printk(&unk_27E, "pwnme");
  return 4294967284LL;
}
// F0: using guessed type __int64 chall_open();
// 880: using guessed type __int64 g_buf;
// 8A0: using guessed type __int64 __fastcall printk(_QWORD, _QWORD);
// 8B8: using guessed type __int64 __fastcall kmalloc_trace(_QWORD, _QWORD, _QWORD);
// 8C0: using guessed type _QWORD kmalloc_caches[6];

//----- (0000000000000150) ----------------------------------------------------
// Alternative name is 'chall_init'
__int64 init_module()
{
  unsigned int v0; // ebx

  v0 = misc_register(&chall_misc);
  if ( v0 )
  {
    printk(&unk_298, "pwnme");
    return v0;
  }
  else
  {
    printk(&unk_1EB, "pwnme");
    return 0;
  }
}
// 150: using guessed type __int64 init_module();
// 8A0: using guessed type __int64 __fastcall printk(_QWORD, _QWORD);
// 8A8: using guessed type __int64 __fastcall misc_register(_QWORD);

//----- (00000000000001B0) ----------------------------------------------------
// Alternative name is 'chall_exit'
__int64 cleanup_module()
{
  kfree(g_buf);
  misc_deregister(&chall_misc);
  return printk(&unk_25E, "pwnme");
}
// 1B0: using guessed type __int64 cleanup_module();
// 880: using guessed type __int64 g_buf;
// 888: using guessed type __int64 __fastcall misc_deregister(_QWORD);
// 898: using guessed type __int64 __fastcall kfree(_QWORD);
// 8A0: using guessed type __int64 __fastcall printk(_QWORD, _QWORD);

// nfuncs=13 queued=6 decompiled=6 lumina nreq=0 worse=0 better=0
// ALL OK, 6 function(s) have been successfully decompiled
